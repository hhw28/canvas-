<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Canvas画板</title>
  <style>
    body,html{
      margin: 0;
      padding: 0;
    }
    #canvas{
      background: rgba(0, 0, 0, 0.3);
      position: absolute;
    }
    .actions{
      position: absolute;
      bottom: 0;
      left: 0;
    }

    .actions #eraser{
      display: inline-block;
    }
    .actions #brush{
      display: none;
    }
    .actions.x > #eraser{
      display: none;
    }
    .actions.x > #brush{
      display: inline-block;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="500" height="500"></canvas>
  <!-- Canvas 的默认大小为300像素×150像素
    请勿在CSS中设置初始宽高，会导致canvas画的图整体等比缩放 -->
  <div id=actions class="actions">
    <button id=eraser >橡皮擦</button>
    <button id=brush >画笔</button>
  </div>


  <script>
    var canvas = document.getElementById('canvas')

//通过测试getContext()方法的存在，检测浏览器是否支持canvas
    if(canvas.getContext){
      var context = canvas.getContext('2d')
      listenToUser(canvas)
      autoSetPageScreen()

/***橡皮擦与画笔的切换***/
      var eraserEnable = false
      eraser.onclick = function(){
        console.log('eraser')
        eraserEnable = true
        actions.className = 'actions x'
      }
      brush.onclick = function(){
        console.log('brush')
        eraserEnable = false
        actions.className = 'actions'
      }

/***监听事件***/
      function listenToUser(canvas){
        var isUse = false
        var lastPoint = {x:undefined, y:undefined}

        //特性检测(是否支持触控)
        if(document.body.ontouchstart !== undefined){
          //支持触控
          canvas.ontouchstart = function(mouse){
            isUse = true

            var x = mouse.touches[0].clientX
            var y = mouse.touches[0].clientY

            if(eraserEnable){
              context.clearRect(x-5,y-5,10,10)
            }else{
              lastPoint = {x:x, y:y}
            }
          }
          canvas.ontouchmove = function(mouse){
            var x = mouse.touches[0].clientX
            var y = mouse.touches[0].clientY

            if(!isUse){ return }
            if(eraserEnable){
              context.clearRect(x-5,y-5,10,10)
            }else{
              var newPoint = {x:x, y:y}
              drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
              lastPoint = newPoint
            }
          }
          canvas.ontouchend = function(){
            isUse = false
          }
        }else{
          //非触控
          canvas.onmousedown = function(mouse){
            isUse = true     //当鼠标按下的时候，开启使用按钮

          //保存鼠标按下的坐标，作为开始画线条的起始点
            var x = mouse.clientX
            var y = mouse.clientY

            if(eraserEnable){
              context.clearRect(x-5,y-5,10,10)
            }else{
              lastPoint = {x:x, y:y}
            }
          }
          canvas.onmousemove = function(mouse){
            var x = mouse.clientX
            var y = mouse.clientY

            if(!isUse){ return }

            if(eraserEnable){    //当橡皮擦被打开的时候
              context.clearRect(x-5,y-5,10,10)   //以鼠标按下的位置为矩形的左上角，所以自身偏移一半的位置
            }else{
              var newPoint = {x:x, y:y}
              // drawCircle(x,y,1)
              drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y)
              lastPoint = newPoint   //更新每次上次的点
            }
          }
          canvas.onmouseup = function(){
            isUse = false
          }
        }
      }

/***自动设置画布***/
      function autoSetPageScreen(){
        setPageScreen()
        window.onresize = function(){
          setPageScreen()   //当浏览器页面大小变动时跟着改变
        }
        function setPageScreen(){
          canvas.width = document.documentElement.clientWidth
          canvas.height = document.documentElement.clientHeight
        }
      }

/***画线***/
      function drawLine(x1,y1,x2,y2){
        context.beginPath()
        context.lineWidth = 3
        context.moveTo(x1,y1)
        context.lineTo(x2,y2)
        context.stroke()
        context.closePath()
      }

      /***画点***/
      function drawCircle(x,y,radius){
        context.beginPath()
        context.arc(x, y, radius, 0, Math.PI*2, true)
        context.fill()
      }

    }else{
      console.log('该浏览器不支持canvas')
    }




  </script>
</body>
</html>